{{define "title"}}Manage Order #{{.Order.OrderID}}{{end}}

{{define "content"}}
<div class="max-w-5xl mx-auto p-6">
  <h1 class="text-3xl font-bold mb-8 text-gray-800 flex items-center justify-between">
    Manage Order #{{.Order.OrderID}}
    <a href="/admin/orders" class="text-sm text-gray-600 hover:text-gray-800">
      ‚Üê Back to Orders
    </a>
  </h1>

  <!-- Error Message -->
  {{if .Error}}
  <div class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
    {{.Error}}
  </div>
  {{end}}

  <!-- Order Details Card -->
  <div class="bg-white shadow-lg rounded-2xl p-6 border border-gray-100 space-y-6">
    <!-- Order Summary -->
    <div>
      <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Order Information</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-700">
        <p><strong>User ID:</strong> {{.Order.UserID}}</p>
        <p><strong>Email:</strong> {{.Order.UserEmail}}</p>
        <p><strong>Date:</strong> {{.Order.OrderDate.Format "2006-01-02 15:04:05"}}</p>
        <p><strong>Current Status:</strong> 
          <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold
            {{if eq .Order.Status "pending"}}bg-yellow-100 text-yellow-700
            {{else if eq .Order.Status "confirmed"}}bg-blue-100 text-blue-700
            {{else if eq .Order.Status "accepted"}}bg-indigo-100 text-indigo-700
            {{else if eq .Order.Status "assigned"}}bg-purple-100 text-purple-700
            {{else if eq .Order.Status "shipped"}}bg-sky-100 text-sky-700
            {{else if eq .Order.Status "completed"}}bg-green-100 text-green-700
            {{else if eq .Order.Status "cancelled"}}bg-red-100 text-red-700
            {{else if eq .Order.Status "refunded"}}bg-gray-200 text-gray-700
            {{end}}">
            {{.Order.Status}}
          </span>
        </p>
      </div>
    </div>

    <!-- Status Control (Admin) -->
    <form action="/admin/orders/status/{{.Order.OrderID}}" method="POST" class="bg-gray-50 border border-gray-200 rounded-xl p-4">
      <h3 class="text-lg font-semibold text-gray-800 mb-3">Change Order Status</h3>
      <div class="flex flex-col sm:flex-row items-center gap-3">
        <select name="status" class="border border-gray-300 rounded-lg px-3 py-2 w-full sm:w-auto focus:ring focus:ring-blue-200">
          <option value="pending" {{if eq .Order.Status "pending"}}selected{{end}}>Pending</option>
          <option value="accepted" {{if eq .Order.Status "accepted"}}selected{{end}}>Accepted</option>
          <option value="confirmed" {{if eq .Order.Status "confirmed"}}selected{{end}}>Confirmed</option>
          <option value="shipped" {{if eq .Order.Status "shipped"}}selected{{end}}>Shipped</option>
          <option value="delivered" {{if eq .Order.Status "delivered"}}selected{{end}}>Delivered</option>
          <!-- <option value="cancelled" {{if eq .Order.Status "cancelled"}}selected{{end}}>Cancelled</option> -->
          <option value="refunded" {{if eq .Order.Status "refunded"}}selected{{end}}>Refunded</option>
          <option value="completed" {{if eq .Order.Status "completed"}}selected{{end}}>Completed</option>

        </select>

        <button type="submit"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-200">
          Update Status
        </button>
      </div>
    </form>

    <!-- Shipping Address -->
    <div>
      <h2 class="text-xl font-semibold text-gray-800 mb-3 border-b pb-2">Shipping Address</h2>
      {{with .Order.Address}}
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-gray-700">
        <p><strong>Street:</strong> {{.Street}}</p>
        <p><strong>City:</strong> {{.City}}</p>
        <p><strong>State:</strong> {{.State}}</p>
        <p><strong>ZIP Code:</strong> {{.ZipCode}}</p>
        <p><strong>Country:</strong> {{.Country}}</p>
      </div>
      {{else}}
      <p class="text-gray-500">No address available.</p>
      {{end}}
    </div>

    <!-- Order Items -->
    <div>
      <h2 class="text-xl font-semibold text-gray-800 mb-3 border-b pb-2">Order Items</h2>
      {{if .Order.Items}}
      <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-200 rounded-lg">
          <thead class="bg-gray-100 text-gray-700 text-sm uppercase">
            <tr>
              <th class="px-4 py-2 text-left">Product</th>
              <th class="px-4 py-2 text-left">Quantity</th>
              <th class="px-4 py-2 text-left">Unit Price</th>
              <th class="px-4 py-2 text-left">Subtotal</th>
              <th class="px-4 py-2 text-center">Actions</th>
            </tr>
          </thead>
          <tbody class="text-gray-700">
            {{range .Order.Items}}
            <tr class="border-t hover:bg-gray-50 transition">
              <td class="px-4 py-2">{{.ProductID}}</td>
              <td class="px-4 py-2">{{.Quantity}}</td>
              <td class="px-4 py-2">${{ .UnitPrice}}</td>
              <td class="px-4 py-2">${{ .Subtotal}}</td>
              <td class="px-4 py-2 text-center">
                <a href="/admin/products/{{.ProductID}}" class="text-blue-600 hover:text-blue-800" title="View Product Details">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </a>
              </td>
            </tr>
            {{end}}
          </tbody>
        </table>
      </div>
      {{else}}
      <p class="text-gray-500">No items found.</p>
      {{end}}
    </div>

    <!-- Payment Info -->
    <div>
      <h2 class="text-xl font-semibold text-gray-800 mb-3 border-b pb-2">Payment Information</h2>
      {{with .Order.Payment}}
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-gray-700">
        <p><strong>Method:</strong> {{.Method}}</p>
        <p><strong>Amount:</strong> ${{ .Amount}}</p>
        <p><strong>Status:</strong> {{.Status}}</p>
      </div>
      {{else}}
      <p class="text-gray-500">No payment information available.</p>
      {{end}}
    </div>
  </div>
</div>
{{end}}
